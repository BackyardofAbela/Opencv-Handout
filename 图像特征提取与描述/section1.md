# Harriså’ŒShi-Tomasç®—æ³•

**å­¦ä¹ ç›®æ ‡**

- ç†è§£Harriså’ŒShi-Tomasiç®—æ³•çš„åŸç†
- èƒ½å¤Ÿåˆ©ç”¨Harriså’ŒShi-Tomasiè¿›è¡Œè§’ç‚¹æ£€æµ‹

# 1 Harrisè§’ç‚¹æ£€æµ‹

## 1.1 åŸç†

Harrisè§’ç‚¹æ£€æµ‹çš„æ€æƒ³æ˜¯é€šè¿‡å›¾åƒçš„å±€éƒ¨çš„å°çª—å£è§‚å¯Ÿå›¾åƒï¼Œè§’ç‚¹çš„ç‰¹å¾æ˜¯çª—å£æ²¿ä»»æ„æ–¹å‘ç§»åŠ¨éƒ½ä¼šå¯¼è‡´å›¾åƒç°åº¦çš„æ˜æ˜¾å˜åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image-20191008144647540](../../../../../01-%E5%B7%A5%E4%BD%9C/03.%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/02.opencv%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9/02.OpenCV%E8%AE%B2%E4%B9%89/%E5%9B%BE%E5%83%8F%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96%E4%B8%8E%E6%8F%8F%E8%BF%B0/assets/image-20191008144647540.png)

å°†ä¸Šè¿°æ€æƒ³è½¬æ¢ä¸ºæ•°å­¦å½¢å¼ï¼Œå³å°†å±€éƒ¨çª—å£å‘å„ä¸ªæ–¹å‘ç§»åŠ¨$$(u,v)$$å¹¶è®¡ç®—æ‰€æœ‰ç°åº¦å·®å¼‚çš„æ€»å’Œï¼Œè¡¨è¾¾å¼å¦‚ä¸‹ï¼š
$$
E(u,v)=\sum_{x,y}w(x,y)[I(x+u,y+v)-I(x,y)]^2
$$
å…¶ä¸­$$I(x,y)$$æ˜¯å±€éƒ¨çª—å£çš„å›¾åƒç°åº¦ï¼Œ$$I(x+u,y+v)$$æ˜¯å¹³ç§»åçš„å›¾åƒç°åº¦ï¼Œ$$w(x,y)$$æ˜¯çª—å£å‡½æ•°ï¼Œè¯¥å¯ä»¥æ˜¯çŸ©å½¢çª—å£ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹æ¯ä¸€ä¸ªåƒç´ èµ‹äºˆä¸åŒæƒé‡çš„é«˜æ–¯çª—å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

![image-20191008153014984](../../../../../01-%E5%B7%A5%E4%BD%9C/03.%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/02.opencv%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9/02.OpenCV%E8%AE%B2%E4%B9%89/%E5%9B%BE%E5%83%8F%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96%E4%B8%8E%E6%8F%8F%E8%BF%B0/assets/image-20191008153014984.png)

è§’ç‚¹æ£€æµ‹ä¸­ä½¿$$E(u,v)$$çš„å€¼æœ€å¤§ã€‚åˆ©ç”¨ä¸€é˜¶æ³°å‹’å±•å¼€æœ‰ï¼š
$$
I(x+u,y+v)=I(x,y)+I_xu+I_yv
$$
å…¶ä¸­$$I_x å’Œ I_y$$ æ˜¯æ²¿xå’Œyæ–¹å‘çš„å¯¼æ•°ï¼Œå¯ç”¨sobelç®—å­è®¡ç®—ã€‚

æ¨å¯¼å¦‚ä¸‹ï¼š
$$
E(u,v)=\sum_{x,y}w(x,y)[I(x+u,y+v)-I(x,y)]^2\\=\sum_{x,y}w(x,y)[I(x,y)+I_xu+I_yv-I(x,y)]^2\\=\sum_{x,y}w(x,y)[I_{x}^2u^2+2I_xI_yuv+I_{y}^2v^2]\\=\sum_{x,y}w(x,y)\left[\begin{matrix}u,v\end{matrix}\right]\left[\begin{matrix}I_x^2,I_xI_y\\I_xI_y,I_y^2\end{matrix}\right]\left[\begin{matrix}u\\v\end{matrix}\right]\\=\left[\begin{matrix}u,v\end{matrix}\right]\sum_{x,y}w(x,y)\left[\begin{matrix}I_x^2,I_xI_y\\I_xI_y,I_y^2\end{matrix}\right]\left[\begin{matrix}u\\v\end{matrix}\right]\\=\left[\begin{matrix}u,v\end{matrix}\right]M\left[\begin{matrix}u\\v\end{matrix}\right]
$$
$$M$$çŸ©é˜µå†³å®šäº†$$E(u,v)$$çš„å–å€¼ï¼Œä¸‹é¢æˆ‘ä»¬åˆ©ç”¨$$M$$æ¥æ±‚è§’ç‚¹ï¼Œ$$M$$æ˜¯$$I_x å’Œ I_y$$çš„äºŒæ¬¡é¡¹å‡½æ•°ï¼Œå¯ä»¥è¡¨ç¤ºæˆæ¤­åœ†çš„å½¢çŠ¶ï¼Œæ¤­åœ†çš„é•¿çŸ­åŠè½´ç”±$$M$$çš„ç‰¹å¾å€¼$$\lambda_1å’Œ\lambda_2$$å†³å®šï¼Œæ–¹å‘ç”±ç‰¹å¾çŸ¢é‡å†³å®šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image-20191008160908338](../../../../../01-%E5%B7%A5%E4%BD%9C/03.%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/02.opencv%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9/02.OpenCV%E8%AE%B2%E4%B9%89/%E5%9B%BE%E5%83%8F%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96%E4%B8%8E%E6%8F%8F%E8%BF%B0/assets/image-20191008160908338.png)

æ¤­åœ†å‡½æ•°ç‰¹å¾å€¼ä¸å›¾åƒä¸­çš„è§’ç‚¹ã€ç›´çº¿ï¼ˆè¾¹ç¼˜ï¼‰å’Œå¹³é¢ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![image-20191008161040473](../../../../../01-%E5%B7%A5%E4%BD%9C/03.%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/02.opencv%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9/02.OpenCV%E8%AE%B2%E4%B9%89/%E5%9B%BE%E5%83%8F%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96%E4%B8%8E%E6%8F%8F%E8%BF%B0/assets/image-20191008161040473.png)

å…±å¯åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š

- å›¾åƒä¸­çš„ç›´çº¿ã€‚ä¸€ä¸ªç‰¹å¾å€¼å¤§ï¼Œå¦ä¸€ä¸ªç‰¹å¾å€¼å°ï¼Œ$$ğœ†_1â‰«ğœ†_2$$æˆ–$$Î»_2â‰«Î»_1$$ã€‚æ¤­åœ†å‡½æ•°å€¼åœ¨æŸä¸€æ–¹å‘ä¸Šå¤§ï¼Œåœ¨å…¶ä»–æ–¹å‘ä¸Šå°ã€‚
- å›¾åƒä¸­çš„å¹³é¢ã€‚ä¸¤ä¸ªç‰¹å¾å€¼éƒ½å°ï¼Œä¸”è¿‘ä¼¼ç›¸ç­‰ï¼›æ¤­åœ†å‡½æ•°æ•°å€¼åœ¨å„ä¸ªæ–¹å‘ä¸Šéƒ½å°ã€‚
- å›¾åƒä¸­çš„è§’ç‚¹ã€‚ä¸¤ä¸ªç‰¹å¾å€¼éƒ½å¤§ï¼Œä¸”è¿‘ä¼¼ç›¸ç­‰ï¼Œæ¤­åœ†å‡½æ•°åœ¨æ‰€æœ‰æ–¹å‘éƒ½å¢å¤§

Harrisç»™å‡ºçš„è§’ç‚¹è®¡ç®—æ–¹æ³•å¹¶ä¸éœ€è¦è®¡ç®—å…·ä½“çš„ç‰¹å¾å€¼ï¼Œè€Œæ˜¯è®¡ç®—ä¸€ä¸ª**è§’ç‚¹å“åº”å€¼$$R$$**æ¥åˆ¤æ–­è§’ç‚¹ã€‚$$R$$çš„è®¡ç®—å…¬å¼ä¸ºï¼š
$$
ğ‘…=ğ‘‘ğ‘’ğ‘¡ğ‘€âˆ’ğ›¼(ğ‘¡ğ‘Ÿğ‘ğ‘ğ‘’ğ‘€)^2
$$
å¼ä¸­ï¼Œ$$ğ‘‘ğ‘’ğ‘¡ğ‘€$$ä¸ºçŸ©é˜µğ‘€çš„è¡Œåˆ—å¼ï¼›ğ‘¡ğ‘Ÿğ‘ğ‘ğ‘’ğ‘€ä¸ºçŸ©é˜µğ‘€çš„è¿¹ï¼›Î±ä¸ºå¸¸æ•°ï¼Œå–å€¼èŒƒå›´ä¸º0.04~0.06ã€‚äº‹å®ä¸Šï¼Œç‰¹å¾æ˜¯éšå«åœ¨ğ‘‘ğ‘’ğ‘¡ğ‘€å’Œğ‘¡ğ‘Ÿğ‘ğ‘ğ‘’ğ‘€ä¸­ï¼Œå› ä¸º:
$$
ğ‘‘ğ‘’ğ‘¡ğ‘€=ğœ†_1ğœ†_2\\ğ‘¡ğ‘Ÿğ‘ğ‘ğ‘’ğ‘€=ğœ†_1+ğœ†_2
$$
é‚£æˆ‘ä»¬æ€ä¹ˆåˆ¤æ–­è§’ç‚¹å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![image-20191008161904372](../../../../../01-%E5%B7%A5%E4%BD%9C/03.%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/02.opencv%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9/02.OpenCV%E8%AE%B2%E4%B9%89/%E5%9B%BE%E5%83%8F%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96%E4%B8%8E%E6%8F%8F%E8%BF%B0/assets/image-20191008161904372.png)

- å½“Rä¸ºå¤§æ•°å€¼çš„æ­£æ•°æ—¶æ˜¯è§’ç‚¹
- å½“Rä¸ºå¤§æ•°å€¼çš„è´Ÿæ•°æ—¶æ˜¯è¾¹ç•Œ
- å½“Rä¸ºå°æ•°æ˜¯è®¤ä¸ºæ˜¯å¹³å¦åŒºåŸŸ

## 1.2 å®ç°

åœ¨OpenCVä¸­å®ç°Hariisæ£€æµ‹ä½¿ç”¨çš„APIæ˜¯ï¼š

```python
dst=cv.cornerHarris(src, blockSize, ksize, k) 
```

å‚æ•°ï¼š

- imgï¼šæ•°æ®ç±»å‹ä¸º ï¬‚oat32 çš„è¾“å…¥å›¾åƒã€‚

- blockSizeï¼šè§’ç‚¹æ£€æµ‹ä¸­è¦è€ƒè™‘çš„é‚»åŸŸå¤§å°ã€‚

- ksizeï¼šsobelæ±‚å¯¼ä½¿ç”¨çš„æ ¸å¤§å°

- k ï¼šè§’ç‚¹æ£€æµ‹æ–¹ç¨‹ä¸­çš„è‡ªç”±å‚æ•°ï¼Œå–å€¼å‚æ•°ä¸º [0.04ï¼Œ0.06].

ç¤ºä¾‹ï¼š

```python
import cv2 as cv
import numpy as np 
import matplotlib.pyplot as plt
img = cv.imread('./image/chessboard.jpg')
gray = cv.cvtColor(img, cv.COLOR_BGR2GRAY)
# è¾“å…¥å›¾åƒå¿…é¡»æ˜¯ float32
gray = np.float32(gray)

# æœ€åä¸€ä¸ªå‚æ•°åœ¨ 0.04 åˆ° 0.05 ä¹‹é—´
dst = cv.cornerHarris(gray,2,3,0.04)
# è†¨èƒ€
dst = cv.dilate(dst,None)
# è®¾ç½®é˜ˆå€¼ï¼Œå°†è§’ç‚¹ç»˜åˆ¶å‡ºæ¥ï¼Œé˜ˆå€¼æ ¹æ®å›¾åƒè¿›è¡Œé€‰æ‹©
img[dst>0.001*dst.max()] = [0,0,255]

plt.figure(figsize=(10,8),dpi=100)
plt.imshow(img[:,:,::-1]),plt.title('Harrisè§’ç‚¹æ£€æµ‹')
plt.xticks([]), plt.yticks([])
plt.show()
```

ç»“æœå¦‚ä¸‹ï¼š

![image-20191008164344988](../../../../../01-%E5%B7%A5%E4%BD%9C/03.%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/02.opencv%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9/02.OpenCV%E8%AE%B2%E4%B9%89/%E5%9B%BE%E5%83%8F%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96%E4%B8%8E%E6%8F%8F%E8%BF%B0/assets/image-20191008164344988.png)

Harrisè§’ç‚¹æ£€æµ‹çš„ä¼˜ç¼ºç‚¹ï¼š

ä¼˜ç‚¹ï¼š

- æ—‹è½¬ä¸å˜æ€§ï¼Œæ¤­åœ†è½¬è¿‡ä¸€å®šè§’åº¦ä½†æ˜¯å…¶å½¢çŠ¶ä¿æŒä¸å˜ï¼ˆç‰¹å¾å€¼ä¿æŒä¸å˜ï¼‰
- å¯¹äºå›¾åƒç°åº¦çš„ä»¿å°„å˜åŒ–å…·æœ‰éƒ¨åˆ†çš„ä¸å˜æ€§ï¼Œç”±äºä»…ä»…ä½¿ç”¨äº†å›¾åƒçš„ä¸€ä»‹å¯¼æ•°ï¼Œå¯¹äºå›¾åƒç°åº¦å¹³ç§»å˜åŒ–ä¸å˜ï¼›å¯¹äºå›¾åƒç°åº¦å°ºåº¦å˜åŒ–ä¸å˜

ç¼ºç‚¹ï¼š

- å¯¹å°ºåº¦å¾ˆæ•æ„Ÿï¼Œä¸å…·å¤‡å‡ ä½•å°ºåº¦ä¸å˜æ€§ã€‚
- æå–çš„è§’ç‚¹æ˜¯åƒç´ çº§çš„

# 2 Shi-Tomasiè§’ç‚¹æ£€æµ‹

## 2.1 åŸç†

Shi-Tomasiç®—æ³•æ˜¯å¯¹Harrisè§’ç‚¹æ£€æµ‹ç®—æ³•çš„æ”¹è¿›ï¼Œä¸€èˆ¬ä¼šæ¯”Harrisç®—æ³•å¾—åˆ°æ›´å¥½çš„è§’ç‚¹ã€‚Harris ç®—æ³•çš„è§’ç‚¹å“åº”å‡½æ•°æ˜¯å°†çŸ©é˜µ M çš„è¡Œåˆ—å¼å€¼ä¸ M çš„è¿¹ç›¸å‡ï¼Œåˆ©ç”¨å·®å€¼åˆ¤æ–­æ˜¯å¦ä¸ºè§’ç‚¹ã€‚åæ¥Shi å’ŒTomasi æå‡ºæ”¹è¿›çš„æ–¹æ³•æ˜¯ï¼Œè‹¥çŸ©é˜µMçš„ä¸¤ä¸ªç‰¹å¾å€¼ä¸­è¾ƒå°çš„ä¸€ä¸ªå¤§äºé˜ˆå€¼ï¼Œåˆ™è®¤ä¸ºä»–æ˜¯è§’ç‚¹ï¼Œå³ï¼š
$$
R= min(\lambda_1,\lambda_2)
$$
å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image-20191008171309192](../../../../../01-%E5%B7%A5%E4%BD%9C/03.%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/02.opencv%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9/02.OpenCV%E8%AE%B2%E4%B9%89/%E5%9B%BE%E5%83%8F%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96%E4%B8%8E%E6%8F%8F%E8%BF%B0/assets/image-20191008171309192.png)

ä»è¿™å¹…å›¾ä¸­ï¼Œå¯ä»¥çœ‹å‡ºæ¥åªæœ‰å½“ Î» 1 å’Œ Î» 2 éƒ½å¤§äºæœ€å°å€¼æ—¶ï¼Œæ‰è¢«è®¤ä¸ºæ˜¯è§’ç‚¹ã€‚

## 2.2 å®ç°

åœ¨OpenCVä¸­å®ç°Shi-Tomasiè§’ç‚¹æ£€æµ‹ä½¿ç”¨API:

```python
corners = cv2.goodFeaturesToTrack ( image, maxcorners, qualityLevel, minDistance )
```

å‚æ•°ï¼š

- Image: è¾“å…¥ç°åº¦å›¾åƒ
- maxCorners : è·å–è§’ç‚¹æ•°çš„æ•°ç›®ã€‚
- qualityLevelï¼šè¯¥å‚æ•°æŒ‡å‡ºæœ€ä½å¯æ¥å—çš„è§’ç‚¹è´¨é‡æ°´å¹³ï¼Œåœ¨0-1ä¹‹é—´ã€‚ 
- minDistanceï¼šè§’ç‚¹ä¹‹é—´æœ€å°çš„æ¬§å¼è·ç¦»ï¼Œé¿å…å¾—åˆ°ç›¸é‚»ç‰¹å¾ç‚¹ã€‚

è¿”å›ï¼š

- Corners: æœç´¢åˆ°çš„è§’ç‚¹ï¼Œåœ¨è¿™é‡Œæ‰€æœ‰ä½äºè´¨é‡æ°´å¹³çš„è§’ç‚¹è¢«æ’é™¤æ‰ï¼Œç„¶åæŠŠåˆæ ¼çš„è§’ç‚¹æŒ‰è´¨é‡æ’åºï¼Œç„¶åå°†è´¨é‡è¾ƒå¥½çš„è§’ç‚¹é™„è¿‘ï¼ˆå°äºæœ€å°æ¬§å¼è·ç¦»ï¼‰çš„è§’ç‚¹åˆ æ‰ï¼Œæœ€åæ‰¾åˆ°maxCornersä¸ªè§’ç‚¹è¿”å›ã€‚

**ç¤ºä¾‹ï¼š**

```python
import numpy as np 
import cv2 as cv
import matplotlib.pyplot as plt

img = cv.imread('./image/tv.jpg') 
gray = cv.cvtColor(img,cv.COLOR_BGR2GRAY)
# è§’ç‚¹æ£€æµ‹
corners = cv.goodFeaturesToTrack(gray,1000,0.01,10)  

for i in corners:
    x,y = i.ravel()
    cv.circle(img,(x,y),2,(0,0,255),-1)

plt.figure(figsize=(10,8),dpi=100)
plt.imshow(img[:,:,::-1]),plt.title('shi-tomasiè§’ç‚¹æ£€æµ‹')
plt.xticks([]), plt.yticks([])
plt.show()
```

ç»“æœå¦‚ä¸‹ï¼š

![image-20191008174257711](../../../../../01-%E5%B7%A5%E4%BD%9C/03.%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/02.opencv%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9/02.OpenCV%E8%AE%B2%E4%B9%89/%E5%9B%BE%E5%83%8F%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96%E4%B8%8E%E6%8F%8F%E8%BF%B0/assets/image-20191008174257711.png)

**æ€»ç»“**

1. Harrisç®—æ³•

   æ€æƒ³ï¼šé€šè¿‡å›¾åƒçš„å±€éƒ¨çš„å°çª—å£è§‚å¯Ÿå›¾åƒï¼Œè§’ç‚¹çš„ç‰¹å¾æ˜¯çª—å£æ²¿ä»»æ„æ–¹å‘ç§»åŠ¨éƒ½ä¼šå¯¼è‡´å›¾åƒç°åº¦çš„æ˜æ˜¾å˜åŒ–ã€‚

   API: cv.cornerHarris()

2. Shi-Tomasiç®—æ³•

   å¯¹Harrisç®—æ³•çš„æ”¹è¿›ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æ£€æµ‹è§’ç‚¹

   API: cv2.goodFeatureToTrack()